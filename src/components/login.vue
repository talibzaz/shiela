<template>
  <div>
    <template>
      <v-container fluid style="background-color: #2e3e4d" >
        <v-layout justify-center align-center style="height: 100vh">
          <v-flex style="border-radius: 4px;background-color: white" md3 pt-5 pl-4 pr-5 pb-5>
            <div style="text-align: center;margin-bottom:50px;">
              <svg style="align-self: center" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                   width="152" height="32" viewBox="0 0 152 32">
                <defs>
                  <path id="a" d="M0 .094h31.693v31.693H0z"/>
                </defs>
                <g fill="none" fill-rule="evenodd">
                  <path fill="#FD8C36"
                        d="M21.023 11.042a.566.566 0 0 1-.46.898H11.13a.566.566 0 0 1-.459-.898c1.11-1.57 3.016-2.604 5.176-2.604s4.068 1.035 5.177 2.604"/>
                  <g transform="translate(0 .12)">
                    <mask id="b" fill="#fff">
                      <use xlink:href="#a"/>
                    </mask>
                    <path fill="#FD8C36"
                          d="M24.255 15.127H11.151a.565.565 0 0 0-.507.813c.971 2.029 3.148 3.439 5.667 3.439 1.664 0 3.17-.608 4.284-1.6a1.602 1.602 0 0 1 2.467 1.986c-1.337 2.329-3.117 4.336-5.193 6.106-.607.512-1.32.781-2.023.787-.708-.006-1.415-.275-2.023-.787-2.741-2.34-4.976-5.092-6.338-8.457-1.342-3.307-.46-7.141 2.123-9.656a8.938 8.938 0 0 1 12.477 0c1.87 1.817 2.847 4.332 2.736 6.835a.563.563 0 0 1-.566.534M27.668.094H4.025A4.023 4.023 0 0 0 0 4.114v23.648a4.024 4.024 0 0 0 4.025 4.025h23.643a4.024 4.024 0 0 0 4.025-4.025V4.114a4.023 4.023 0 0 0-4.025-4.02"
                          mask="url(#b)"/>
                  </g>
                  <path fill="#2e3e50"
                        d="M44.75 14.353c0-1.572-.669-2.358-2.007-2.358-1.439 0-2.258 1.062-2.459 3.186H44.7c.034-.367.05-.643.05-.828zm2.86 3.011h-7.35c.1 1.204.405 2.04.915 2.51.51.468 1.242.702 2.195.702.502 0 .992-.05 1.468-.15.477-.101.832-.201 1.066-.302l.326-.15c.603.585.92 1.33.954 2.232-.117.084-.28.18-.49.29-.209.108-.685.259-1.43.45a9.345 9.345 0 0 1-2.345.29c-2.024 0-3.513-.578-4.466-1.732-.954-1.154-1.43-2.885-1.43-5.193 0-2.292.501-3.994 1.505-5.107 1.003-1.112 2.409-1.668 4.215-1.668 1.606 0 2.864.43 3.776 1.292.912.862 1.368 2.162 1.368 3.902 0 .468-.021.924-.063 1.367a7.268 7.268 0 0 1-.138.966l-.075.301zM52.15 9.987l2.308 7.277c.134.418.259.861.376 1.33.117.468.201.828.251 1.079l.05.401h.101c.2-.903.46-1.848.778-2.836l2.333-7.25c.351-.134.828-.201 1.43-.201.285 0 .548.017.79.05.243.034.415.067.515.1l.15.05-4.164 12.797c-.553.134-1.205.2-1.957.2a9.945 9.945 0 0 1-1.732-.15l-.226-.05-4.265-12.797c.401-.133.944-.2 1.63-.2.335 0 .636.017.904.05.268.034.452.067.552.1l.176.05zM69.898 14.353c0-1.572-.669-2.358-2.007-2.358-1.439 0-2.258 1.062-2.459 3.186h4.416c.033-.367.05-.643.05-.828zm2.86 3.011h-7.35c.1 1.204.404 2.04.915 2.51.51.468 1.242.702 2.196.702.502 0 .99-.05 1.467-.15.477-.101.832-.201 1.067-.302l.326-.15c.602.585.92 1.33.953 2.232-.117.084-.28.18-.489.29-.21.108-.686.259-1.43.45a9.339 9.339 0 0 1-2.346.29c-2.024 0-3.513-.578-4.466-1.732-.954-1.154-1.43-2.885-1.43-5.193 0-2.292.501-3.994 1.505-5.107 1.004-1.112 2.409-1.668 4.215-1.668 1.606 0 2.865.43 3.776 1.292.912.862 1.368 2.162 1.368 3.902 0 .468-.021.924-.063 1.367a7.28 7.28 0 0 1-.138.966l-.075.301zM85.876 13.35v9.434c-.368.134-.895.2-1.58.2-.336 0-.632-.016-.891-.05a3.256 3.256 0 0 1-.54-.1l-.15-.05v-8.882c0-1.205-.67-1.807-2.008-1.807-.82 0-1.556.31-2.208.929v9.76c-.368.134-.895.2-1.58.2-.335 0-.632-.016-.89-.05a3.229 3.229 0 0 1-.54-.1l-.151-.05V9.988c.318-.134.844-.201 1.58-.201.302 0 .586.016.853.05.268.034.453.067.553.1l.175.05v.753c.887-.803 2.033-1.204 3.438-1.204 1.254 0 2.224.347 2.91 1.041.686.694 1.029 1.619 1.029 2.773M92.866 12.12v5.972c0 1.02.184 1.71.552 2.07.368.36.979.54 1.832.54l.878-.076c.15.368.226.787.226 1.254 0 .201-.012.398-.038.59-.025.192-.054.33-.088.414l-.05.126c-.518.15-1.137.225-1.857.225-1.589 0-2.756-.414-3.5-1.242-.744-.827-1.116-2.078-1.116-3.75V12.12h-1.907c-.117-.3-.176-.685-.176-1.154 0-.234.013-.447.038-.64.025-.192.054-.33.088-.414l.05-.125h1.907V7.629c.87-.518 1.923-.728 3.161-.627v2.785h2.961c.117.285.176.669.176 1.154 0 .2-.013.401-.038.602-.025.2-.054.351-.088.452l-.05.125h-2.96zM105.14 17.113c-.836-.066-1.53-.1-2.082-.1-1.355 0-2.032.627-2.032 1.882 0 1.288.602 1.932 1.806 1.932.803 0 1.388-.297 1.757-.891.367-.593.552-1.284.552-2.07v-.753zm-6.373-6.574c1.238-.668 2.744-1.003 4.516-1.003 1.807 0 3.095.376 3.865 1.129.769.753 1.154 1.932 1.154 3.538v8.58c-.235.135-.644.201-1.23.201a4.205 4.205 0 0 1-1.129-.15l-.15-.05-.477-1.355c-.585 1.204-1.807 1.807-3.663 1.807-1.222 0-2.175-.365-2.86-1.092-.687-.728-1.03-1.81-1.03-3.25 0-2.659 1.632-3.989 4.893-3.989.853 0 1.681.042 2.485.126v-.552c0-1.522-.753-2.283-2.259-2.283-.485 0-.995.05-1.53.15-.536.1-.953.2-1.255.301l-.426.15c-.268-.166-.502-.476-.703-.928a2.626 2.626 0 0 1-.175-.64 3.721 3.721 0 0 1-.05-.514l.024-.176zM116.787 12.095c-1.07 0-1.827.335-2.27 1.003-.443.67-.665 1.766-.665 3.287 0 1.49.238 2.56.715 3.212.477.652 1.25.979 2.321.979.384 0 .765-.03 1.142-.088.376-.059.656-.113.84-.163l.277-.1c.551.501.844 1.246.877 2.233-.72.518-1.974.778-3.763.778-3.764 0-5.646-2.284-5.646-6.85 0-4.567 1.882-6.85 5.646-6.85.77 0 1.446.054 2.032.163.586.109.979.222 1.18.339l.3.15c0 .937-.292 1.681-.878 2.234-.569-.218-1.271-.327-2.108-.327M125.993 14.93l3.111-4.942c.435-.134.962-.201 1.581-.201.251 0 .506.016.766.05.259.034.455.067.59.1l.2.05-3.663 5.897 4.24 6.9c-.485.15-1.07.226-1.756.226-.318 0-.62-.017-.904-.05-.284-.034-.485-.076-.601-.126l-.202-.05-3.412-5.52h-.753v5.52c-.418.134-.937.2-1.555.2-.285 0-.561-.016-.828-.05a4.17 4.17 0 0 1-.577-.1l-.201-.05V4.317c.435-.1.97-.15 1.606-.15l1.555.15V14.93h.803zM137.774 4.367v18.417c-.369.134-.895.2-1.581.2-.335 0-.632-.016-.89-.05a3.21 3.21 0 0 1-.54-.1l-.15-.05V4.367c.317-.134.843-.2 1.58-.2.3 0 .585.016.853.05.267.033.46.067.577.1l.15.05zM147.925 14.353c0-1.572-.67-2.358-2.007-2.358-1.439 0-2.258 1.062-2.46 3.186h4.417c.033-.367.05-.643.05-.828zm2.86 3.011h-7.351c.1 1.204.405 2.04.916 2.51.51.468 1.242.702 2.195.702.502 0 .991-.05 1.468-.15.476-.101.832-.201 1.066-.302l.326-.15c.603.585.92 1.33.954 2.232a4.2 4.2 0 0 1-.49.29c-.21.108-.686.259-1.43.45a9.346 9.346 0 0 1-2.345.29c-2.025 0-3.513-.578-4.467-1.732-.953-1.154-1.43-2.885-1.43-5.193 0-2.292.502-3.994 1.505-5.107 1.004-1.112 2.41-1.668 4.216-1.668 1.605 0 2.864.43 3.776 1.292.911.862 1.367 2.162 1.367 3.902 0 .468-.02.924-.063 1.367a7.268 7.268 0 0 1-.137.966l-.075.301z"/>
                </g>
              </svg>
            </div>

            <v-form ref="form" v-model="valid" lazy-validation>
                <v-text-field  class="normal-font"
                             solo prepend-icon="person"
                             name="Name"
                             label="Username"
                             :rules="nameRules"
                             v-model="email"
                             v-on:keypress.enter="login"
                             required
              >
              </v-text-field>
              <v-text-field class="normal-font"
                            solo
                            prepend-icon="lock"
                            name="Password"
                            label="Password"
                            type="password"
                            v-model="password"
                            :rules="nameRules"
                            v-on:keypress.enter="login"
                            required
              >
              </v-text-field>
              <v-flex style="text-align: center">
                <v-btn
                        :disabled="dialog"
                        :loading="dialog"
                        class="white--text"
                        color="blue darken-2"
                        @click="login"
                >
                  Login
                </v-btn>
              </v-flex>
            </v-form>
          </v-flex>
        </v-layout>
      </v-container>
    </template>

    <template>
      <div class="text-xs-center">

        <v-dialog
                v-model="dialog"
                hide-overlay
                persistent
                width="300"
        >
          <v-card
                  color="white"
                  dark
          >
            <v-card-text style="color: #000000">
              {{loginMessage}}
              <v-progress-circular
                      v-if="loading"
                      :width="3"
                      color="black"
                      indeterminate
              ></v-progress-circular>
            </v-card-text>
          </v-card>
        </v-dialog>
      </div>
    </template>
  </div>
</template>

<script>
    import axios from "axios";
    import * as Storage from '../storage'
    import * as Constants from '../constants'

    export default {
        name: "Login",
        data() {
            return {
                loginMessage: "",
                valid: true,
                loading: true,
                dialog: false,
                email: '',
                password: '',
                nameRules: [
                    v => !!v || 'Please enter the mandatory fields',
                ]
            }
        },
        methods: {
            login() {
                if (this.$refs.form.validate()){
                    this.dialog = true;
                    axios.post(Constants.loginURI(), {
                        email: this.email,
                        password: this.password
                    }, {headers: {"Content-Type": "application/json"}}).then(res => {
                        if (res.data.status) {
                            Storage.setToken(res.data.token);
                            this.loading = false;
                            this.$router.push({path:'/'})
                        } else {
                            this.loading = false;
                            this.loginMessage = res.data.message
                        }
                    }).catch(error => {
                        if (error.message == "Request failed with status code 400") {
                            this.loading = false;
                            this.loginMessage = "INCORRECT EMAIL / PASSWORD";
                            setTimeout(() => {
                                this.dialog = false;
                                this.loading = true;
                                this.loginMessage = "";
                            }, 1500)
                        } else if (error.message == "Request failed with status code 401"){
                            this.loading = false;
                            this.loginMessage = "INCORRECT EMAIL / PASSWORD";
                            setTimeout(() => {
                                this.dialog = false;
                                this.loading = true;
                                this.loginMessage = "";
                            }, 1500)
                        } else {
                            this.loading = false;
                            this.loginMessage = error.message;
                            setTimeout(() => {
                                this.dialog = false;
                                this.loading = true;
                                this.loginMessage = "";
                            }, 1500)
                        }
                    })
                }
            }
        }
    }
</script>

<style scoped>
  @import "../styles/common.css";


</style>
